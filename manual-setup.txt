=====================================================================
ИНСТРУКЦИЯ ПО РУЧНОЙ НАСТРОЙКЕ САЙТА НА ДОМЕНЕ DOMU-MEBEL.RU
=====================================================================

1. УСТАНОВКА NGINX:
------------------
1. Скачайте Nginx по ссылке: https://nginx.org/download/nginx-1.24.0.zip
2. Распакуйте архив в папку C:\nginx
3. Создайте в папке C:\nginx\conf папку sites-enabled:
   mkdir C:\nginx\conf\sites-enabled

2. НАСТРОЙКА КОНФИГУРАЦИИ NGINX:
-------------------------------
1. Создайте файл C:\nginx\conf\nginx.conf со следующим содержимым:

worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    include sites-enabled/*.conf;
}

2. Создайте файл C:\nginx\conf\sites-enabled\domu-mebel.ru.conf:

server {
    listen 80;
    server_name domu-mebel.ru www.domu-mebel.ru;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/ {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /static/ {
        proxy_pass http://localhost:5000/static/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

3. ЗАПУСК NGINX:
---------------
1. Откройте командную строку или PowerShell от имени администратора
2. Перейдите в папку с nginx: cd C:\nginx
3. Запустите nginx: .\nginx.exe

4. УСТАНОВКА CERTBOT (ДЛЯ HTTPS):
--------------------------------
1. Скачайте установщик Certbot для Windows: https://dl.eff.org/certbot-beta-installer-win32.exe
2. Установите его, следуя инструкциям установщика
3. Откройте командную строку от имени администратора и выполните:
   certbot certonly --standalone --agree-tos --email tawer0228@gmail.com -d domu-mebel.ru -d www.domu-mebel.ru

5. НАСТРОЙКА HTTPS В NGINX:
-------------------------
1. После получения сертификата обновите файл C:\nginx\conf\sites-enabled\domu-mebel.ru.conf:

server {
    listen 80;
    server_name domu-mebel.ru www.domu-mebel.ru;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name domu-mebel.ru www.domu-mebel.ru;

    ssl_certificate "C:/Certbot/live/domu-mebel.ru/fullchain.pem";
    ssl_certificate_key "C:/Certbot/live/domu-mebel.ru/privkey.pem";
    ssl_session_cache shared:SSL:1m;
    ssl_session_timeout 5m;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/ {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /static/ {
        proxy_pass http://localhost:5000/static/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}

2. Перезапустите nginx: 
   .\nginx.exe -s reload

6. ЗАПУСК ПРИЛОЖЕНИЯ:
-------------------
1. Запустите серверную часть:
   cd путь_к_проекту
   .\start-server.bat

2. Если вы хотите разрабатывать приложение, запустите клиентскую часть в режиме разработки:
   cd путь_к_проекту
   .\start-client.bat

3. Если вы хотите запустить приложение в продакшн-режиме, соберите клиентскую часть:
   cd путь_к_проекту
   .\build-client.bat

7. НАСТРОЙКА АВТООБНОВЛЕНИЯ СЕРТИФИКАТА:
--------------------------------------
1. Создайте файл renew-cert.ps1 со следующим содержимым:

certbot renew --quiet
cd C:\nginx
.\nginx.exe -s reload

2. Настройте планировщик заданий Windows для запуска этого скрипта ежедневно в 3:00 утра:
   - Откройте Планировщик заданий (Task Scheduler)
   - Создайте новую задачу (Create Task)
   - На вкладке "Общие" (General) укажите имя "LetsEncryptRenewal"
   - На вкладке "Триггеры" (Triggers) добавьте ежедневный триггер на 3:00
   - На вкладке "Действия" (Actions) добавьте запуск PowerShell с аргументом "-File путь_к_файлу\renew-cert.ps1"
   - Сохраните задачу

8. ПРОВЕРКА РАБОТЫ:
-----------------
После настройки зайдите на https://domu-mebel.ru для проверки работы сайта.

===================================================================== 